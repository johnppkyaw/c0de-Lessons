<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kanban Board</title>
  <style>
    body {
      display: flex;
      margin-top: 30px;      
    }
    .each-board {
      display: inline-block;
      margin-left: 30px;
      width: 25%;
    }

    .each-board:last-of-type {
      margin-right: 30px;
    }

    .input-area {
      display: flex;
      width: 100%;
      margin-top: -5px;
    }

    textarea {
      width: 100%;
    }

    .title {
      color: white;
      padding: 10px;
      text-align: center;
    }

    #to-do {
      background-color: #35235D;
    }

    #doing {
      background-color: #CB2402;
    }

    #done {
      background-color: #4C49A2;
    }

    #approved {
      background-color: #A31A48;
    }

    #undo-btn {
      position:fixed;
      bottom: 0;
      right: 0;
      padding: 20px;
    }

    .task {
      margin-bottom: 5px;
      padding: 5px;
      background-color: rgb(231, 219, 215);
      display: flex;
      justify-content: space-between;
      align-items: center;
      word-break: break-all;
      gap: 10px;
    }
  </style>
</head>
<body>
  <button id="undo-btn">Undo</button>
  <script>
    const numberOfBoards = 4;
    for (let i = 1; i <= numberOfBoards; i++) {
      const newBoard = document.createElement('div');
      newBoard.setAttribute('class', 'each-board');
      newBoard.innerHTML = "board #" + i;
      document.body.appendChild(newBoard);
    }

    const initial = [
      {title: "To-Do", color: "#35235D", tasks: []},
      {title: "Doing", color: "#CB2402", tasks: []},
      {title: "Done", color: "#4C49A2", tasks: []},
      {title: "Approved", color: "#A31A48", tasks: []},
    ];

    const data = JSON.parse(localStorage.getItem('Kanban')) || initial;

    const manageTask = (command, task, index, taskId, swapDirection) => {
      switch(command) {
        case 'add':
          data[index].tasks.push(task);
          localStorage.setItem('Kanban', JSON.stringify(data));
          renderBoard();
          return;
        case 'swap':
          data[index].tasks.splice(taskId, 1);
          data[index + swapDirection].tasks.push(task);
          localStorage.setItem('Kanban', JSON.stringify(data));
          renderBoard();
          return;
        case 'delete':
          data[index].tasks.splice(taskId, 1);
          localStorage.setItem('Kanban', JSON.stringify(data));
          renderBoard();
        default: return;
      }

    }

    const saveTask = (index) => {
      const targetTextArea = document.querySelector(`#input-data-${index}`);
      if(targetTextArea.value.length < 0) return;
      manageTask('add', targetTextArea.value, index);
      targetTextArea.value = "";       
    }

    const renderBoard = () => {
      data.forEach((board, index) => {
        console.log(board.tasks);
        const currentBoard = data[index];
        const currentBoardTitle = currentBoard.title;
        const currentBoardColor = currentBoard.color;
        const currentTaskList = currentBoard.tasks;
        const currentBoardDiv = document.querySelectorAll('.each-board')[index];
        const leftBracket = index > 0 ? "<" : "";
        const rightBracket = index < numberOfBoards - 1 ? ">" : "";
        currentBoardDiv.innerHTML = `
          <div class="title" style="background-color: ${currentBoardColor}">${currentBoardTitle}</div>
          <div id="task-container-${index}">
            ${board.tasks.reduce((acc, task) => {
              return acc + `<div class="task"><div>${leftBracket}</div>
              <div>${task}</div><div>${rightBracket}</div></div>`              
            }, "")}
            </div>
            <div class="input-area">
          <textarea rows="5" id="input-data-${index}"></textarea>
          <button type="button" id="input-submit-${index}-btn" onclick="saveTask(${index})">Submit</button>
          </div>
        `;
      });
    }
    renderBoard();
  </script>  
</body>
</html>
